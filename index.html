<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Organizer Dashboard</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app" class="app-shell">
    <aside class="sidebar" id="sidebar">
      <div class="brand">Organizer</div>
      <nav class="nav">
        <button class="nav-btn active" data-view="table">Table</button>
        <button class="nav-btn" data-view="board">Kanban</button>
        <button class="nav-btn" data-view="map">Map</button>
        <button class="nav-btn" data-view="compendium">Compendium</button>
        <button class="nav-btn" data-view="about">About</button>
      </nav>
      <div class="sidebar-footer">
        <button id="refreshBtn" class="accent-btn" title="Reload data">‚Üª Refresh</button>
        <label class="toggle tiny">
          <input type="checkbox" id="autoRefreshToggle" checked>
          <span>Auto</span>
        </label>
      </div>
    </aside>
    <main class="main">
      <header class="topbar">
        <div class="breadcrumbs" id="statusLine">Loading‚Ä¶</div>
  <div class="spacer"></div>
  <button id="sheetConfigBtn" class="mini-btn" title="Configure sheet">‚öôÔ∏è</button>
  <button id="uploadBtn" class="mini-btn" title="Upload local Excel/CSV">Upload</button>
  <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display:none" />
  <a class="mini-btn" id="templateLink" href="assets/template.csv" download>Template</a>
        <input type="search" id="search" placeholder="Search‚Ä¶" autocomplete="off" />
        <button id="themeSwitch" title="Toggle theme">üåô</button>
      </header>

      <section id="view-table" class="view active">
        <div class="toolbar">
          <div class="left-tools">
            <select id="columnFilter"></select>
            <select id="valueFilter"></select>
          </div>
          <div class="right-tools">
            <button id="exportJson" class="mini-btn">Export JSON</button>
            <button id="exportCsv" class="mini-btn">Export CSV</button>
          </div>
        </div>
        <div class="table-wrap">
          <table id="dataTable">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section id="view-board" class="view">
        <div id="kanban" class="kanban"></div>
      </section>

      <section id="view-map" class="view">
        <div class="map-toolbar">
          <button id="addTokensBtn" class="mini-btn">Add Filtered as Tokens</button>
          <label>Grid <input type="number" id="gridSizeInput" value="50" min="20" max="120" step="5" style="width:70px" /></label>
          <button id="clearTokensBtn" class="mini-btn">Clear Tokens</button>
        </div>
        <div id="mapStage" class="map-stage">
          <canvas id="battleMap" width="1200" height="800"></canvas>
          <div class="token-layer" id="tokenLayer"></div>
          <div class="fog-layer" id="fogLayer"></div>
          <div class="walls-layer" id="wallsLayer"></div>
        </div>
        <p class="map-hint">Drag tokens. This is an early prototype: upcoming ‚Äî fog reveal brush, vision cones, wall bounces.</p>
      </section>

      <section id="view-compendium" class="view">
        <div class="comp-toolbar">
          <label><input type="checkbox" id="showPlayers" checked /> Players</label>
          <label><input type="checkbox" id="showItems" checked /> Items</label>
          <label><input type="checkbox" id="showEnemies" checked /> Enemies</label>
        </div>
        <div id="compGallery" class="grid-board"></div>
        <div id="compDetail" class="comp-detail hidden"></div>
      </section>

      <section id="view-about" class="view prose">
        <h1>About</h1>
        <p>This dashboard pulls live data from a Google Sheet you control. Edit the sheet, refresh here, done.</p>
        <ol>
          <li>Open your sheet in Google Sheets.</li>
          <li>File ‚Üí Share ‚Üí Publish to web ‚Üí Select the tab ‚Üí CSV ‚Üí Publish.</li>
          <li>Copy the generated URL and paste it into <code>config.js</code> (GOOGLE_SHEET_CSV_URL).</li>
          <li>Reload this page.</li>
        </ol>
        <p>Use search, filters, board view, and quick export. Data never leaves your browser.</p>
      </section>

      <footer class="footer">Live sheet sync ‚Ä¢ <span id="recordCount">0</span> rows ‚Ä¢ <span id="lastUpdated">‚Äî</span></footer>
    </main>
  </div>
  <div id="sheetModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-panel">
      <header><h2>Sheet Source</h2><button id="closeSheetModal" class="close-btn" aria-label="Close">√ó</button></header>
      <p>Paste the Published CSV URL from Google Sheets. (File ‚Üí Share ‚Üí Publish to web ‚Üí CSV)</p>
      <textarea id="sheetUrlInput" placeholder="https://docs.google.com/spreadsheets/d/.../pub?output=csv"></textarea>
      <div class="actions">
        <button id="saveSheetUrl" class="accent-btn">Save & Reload</button>
        <button id="clearSheetUrl" class="mini-btn">Clear Override</button>
  <button id="modalUploadBtn" class="mini-btn" type="button">Upload Local File‚Ä¶</button>
      </div>
      <small>Stored locally in your browser. Share the link hash like <code>#sheet=&lt;url&gt;</code> to preload.</small>
    </div>
  </div>
  <script src="js/config.js"></script>
  <script src="js/persist.js"></script>
  <script src="js/sheet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/compendium.js"></script>
</body>
</html>
