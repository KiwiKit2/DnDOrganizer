/* Root theme vars */
:root {
  --bg: #0d0f11;
  --bg-alt: #14171a;
  --bg-raised: #1d2125;
  --border: #2a2f35;
  --border-accent: #444b53;
  --text: #d6d9dd;
  --text-dim: #7d848c;
  --accent: #4f8dff;
  --accent-glow: 174 72% 56%;
  --danger: #ff5576;
  --radius-s: 4px;
  --radius-m: 8px;
  --radius-l: 14px;
  --shadow-1: 0 2px 4px -2px rgba(0,0,0,.5),0 4px 16px -4px rgba(0,0,0,.4);
  font-family: 'Inter', system-ui, sans-serif;
  color-scheme: dark;
}

.light {
  --bg: #f5f7fa;
  --bg-alt: #ffffff;
  --bg-raised: #ffffff;
  --border: #dfe3e7;
  --border-accent: #b9c2ca;
  --text: #222;
  --text-dim: #66707a;
  --accent: #155eef;
  --danger: #d43652;
  color-scheme: light;
}

html,body {height:100%;margin:0;padding:0;background:var(--bg);color:var(--text);} 
body {display:flex;}

.app-shell {display:flex;flex:1;min-height:100vh;width:100%;}
.sidebar {width:220px;background:linear-gradient(180deg,var(--bg-alt),var(--bg));border-right:1px solid var(--border);display:flex;flex-direction:column;padding:18px 14px;gap:20px;}
.brand {font-size:20px;font-weight:600;letter-spacing:.5px;}
.nav {display:flex;flex-direction:column;gap:6px;}
.nav-btn {all:unset;cursor:pointer;padding:10px 12px;border-radius:var(--radius-m);font-size:14px;font-weight:500;background:var(--bg-raised);border:1px solid var(--border);transition:.25s;background:linear-gradient(145deg,#171b1f,#15181b);}
.nav-btn:hover {border-color:var(--border-accent);}
.nav-btn.active {background:var(--accent);color:#fff;box-shadow:0 0 0 1px #000,0 0 0 2px var(--accent);}
.sidebar-footer {margin-top:auto;display:flex;align-items:center;gap:10px;}
.toggle {display:flex;align-items:center;gap:4px;font-size:12px;cursor:pointer;}
.toggle input {accent-color:var(--accent);}

.main {flex:1;display:flex;flex-direction:column;}
.topbar {display:flex;align-items:center;gap:14px;padding:12px 18px;border-bottom:1px solid var(--border);background:var(--bg-alt);backdrop-filter:blur(8px);position:sticky;top:0;z-index:20;}
.breadcrumbs {font-size:13px;color:var(--text-dim);}
#search {background:var(--bg-raised);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:var(--radius-l);min-width:220px;font-size:14px;}
#search:focus {outline:2px solid var(--accent);}
#themeSwitch {background:var(--bg-raised);color:var(--text);border:1px solid var(--border);border-radius:50%;width:38px;height:38px;cursor:pointer;font-size:16px;display:grid;place-items:center;}
#themeSwitch:hover {border-color:var(--accent);}
.pulse {animation:pulse 1s ease-in-out 0s 4 alternate;}
@keyframes pulse {from {box-shadow:0 0 0 0 var(--accent);} to {box-shadow:0 0 0 6px rgba(79,141,255,0);} }

.view {display:none;padding:18px 22px;animation:fade .4s ease;}
.view.active {display:block;}
@keyframes fade {from {opacity:0;transform:translateY(6px);} to {opacity:1;transform:translateY(0);} }

.toolbar {display:flex;justify-content:space-between;align-items:center;gap:20px;margin-bottom:12px;flex-wrap:wrap;}
.table-wrap {overflow:auto;border:1px solid var(--border);border-radius:var(--radius-m);background:var(--bg-raised);box-shadow:var(--shadow-1);max-height:calc(100vh - 250px);}
#dataTable {border-collapse:collapse;width:100%;min-width:800px;font-size:13px;}
#dataTable th,#dataTable td {padding:8px 10px;border-bottom:1px solid var(--border);text-align:left;}
#dataTable thead th {position:sticky;top:0;background:var(--bg-alt);z-index:5;font-weight:600;font-size:12px;letter-spacing:.5px;text-transform:uppercase;cursor:pointer;}
#dataTable tbody tr {transition:.15s;background:linear-gradient(145deg,#14171a,#121416);}
#dataTable tbody tr:hover {background:#1b2024;}
#dataTable tbody tr.selected {outline:2px solid var(--accent);}

.mini-btn, .accent-btn {all:unset;cursor:pointer;background:var(--accent);color:#fff;padding:8px 14px;border-radius:var(--radius-m);font-size:12px;font-weight:600;letter-spacing:.5px;box-shadow:0 2px 4px -2px rgba(0,0,0,.6),0 4px 10px -2px rgba(0,0,0,.4);}
.mini-btn {background:var(--bg-raised);color:var(--text);border:1px solid var(--border);padding:6px 10px;font-weight:500;}
.mini-btn:hover {border-color:var(--border-accent);}
.mini-btn:active {transform:translateY(1px);}
.mini-btn.danger {color:#ff667d;border-color:#ff667d;background:rgba(255,80,110,0.08);} 
.mini-btn.danger:hover {background:rgba(255,80,110,0.15);} 
.accent-btn:hover {filter:brightness(1.1);}

select {background:var(--bg-raised);color:var(--text);border:1px solid var(--border);padding:6px 10px;border-radius:var(--radius-m);font-size:13px;}
select:focus {outline:2px solid var(--accent);}

.kanban {display:flex;gap:18px;align-items:flex-start;overflow-x:auto;padding-bottom:20px;}
.board-toolbar {display:flex;gap:16px;align-items:center;margin-bottom:14px;flex-wrap:wrap;}
.empty-hint {margin-top:20px;font-size:13px;color:var(--text-dim);} 
.empty-hint.hidden {display:none;}
.kanban-column {background:var(--bg-raised);border:1px solid var(--border);border-radius:var(--radius-m);min-width:260px;display:flex;flex-direction:column;max-height:calc(100vh - 240px);}
.kanban-column header {padding:10px 14px;font-size:13px;font-weight:600;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.kanban-column header span {opacity:.55;font-weight:500;}
.kanban-column.over-wip header {background:linear-gradient(90deg,rgba(255,85,118,0.18),transparent);}
.kanban-column header .add-mini {padding:4px 8px;font-size:11px;}
.kanban-column header .col-title {cursor:pointer;}
.kanban-cards {display:flex;flex-direction:column;gap:10px;overflow:auto;padding:14px;}
.board-summary{display:flex;flex-wrap:wrap;gap:10px;margin:4px 0 14px;font-size:11px}
.board-summary .metric{background:var(--bg-raised);border:1px solid var(--border);padding:6px 10px;border-radius:30px;display:flex;align-items:center;gap:8px;line-height:1}
.board-summary .metric .bar{width:90px;height:6px;background:#1a1f23;border-radius:4px;overflow:hidden;position:relative}
.board-summary .metric .bar span{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,var(--accent),#7fb3ff);}
.card {background:linear-gradient(145deg,#20252a,#1b1f23);border:1px solid var(--border);border-radius:var(--radius-m);padding:10px 12px;font-size:12px;display:flex;flex-direction:column;gap:6px;cursor:grab;box-shadow:0 2px 4px -2px rgba(0,0,0,.6),0 4px 16px -4px rgba(0,0,0,.4);} 
.card.dragging {opacity:.4;}
.card h4 {margin:0;font-size:12px;font-weight:600;}
.card .meta {display:flex;flex-wrap:wrap;gap:6px;font-size:11px;color:var(--text-dim);}
.badge {background:var(--accent);color:#fff;padding:2px 6px;border-radius:var(--radius-s);font-size:10px;font-weight:600;letter-spacing:.5px;}
.card img.thumb {width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:1px solid var(--border);background:#111;}
.grid-board {display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:16px;padding:10px 4px;}
.grid-token {background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;padding:10px;display:flex;flex-direction:column;gap:8px;position:relative;box-shadow:var(--shadow-1);} 
.grid-token img {width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:12px;border:1px solid var(--border);background:#090b0d;}
.grid-token h5 {margin:0;font-size:13px;font-weight:600;}
.tag-row {display:flex;flex-wrap:wrap;gap:6px;font-size:10px;color:var(--text-dim);} 

.footer {margin-top:auto;padding:10px 18px;font-size:12px;color:var(--text-dim);border-top:1px solid var(--border);background:var(--bg-alt);display:flex;gap:18px;align-items:center;}

.prose {max-width:760px;}
.prose h1 {margin-top:0;font-size:28px;}
.prose code {background:var(--bg-raised);padding:2px 6px;border-radius:var(--radius-s);}

.stats-summary {display:grid;gap:12px;margin-top:24px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));}
.stat-box {background:var(--bg-raised);border:1px solid var(--border);padding:14px 16px;border-radius:var(--radius-m);display:flex;flex-direction:column;gap:4px;}
.stat-box h3 {margin:0;font-size:13px;font-weight:600;color:var(--text-dim);}
.stat-box .value {font-size:20px;font-weight:600;}

/* Modal */
/* Map prototype */
.map-toolbar {display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap;}
.map-stage {position:relative;overflow:auto;border:1px solid var(--border);border-radius:18px;background:#0b0e10;min-height:520px;box-shadow:var(--shadow-1);} 
#battleMap {background:repeating-conic-gradient(from 0deg,#111 0deg,#111 90deg,#101417 90deg,#101417 180deg);background-size:60px 60px;display:block;border-radius:14px;}
.token-layer,.fog-layer,.walls-layer,.overlay-layer {position:absolute;left:0;top:0;inset:0;}
.token-layer {pointer-events:auto;}
.fog-layer {pointer-events:none;}
.walls-layer {pointer-events:none;}
.overlay-layer {pointer-events:auto;}
.token {position:absolute;transform:translate(-50%,-50%);width:60px;height:60px;border:2px solid var(--accent);border-radius:50%;background:#222 center/cover no-repeat;box-shadow:0 4px 12px -4px rgba(0,0,0,.6);} 
.token[data-type="enemy"] {border-color:#ff5576;}
.token[data-type="player"] {border-color:#4f8dff;}
.token.selected {outline:3px solid #fff;}
.token .badge-stack {position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);display:flex;gap:4px;}
.token .hp-badge {background:#1a2228;color:#fff;font-size:9px;padding:2px 5px;border-radius:10px;border:1px solid var(--border);min-width:26px;text-align:center;}
.token .status-dot {width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 1px #000;}
.map-hint {font-size:12px;color:var(--text-dim);margin-top:10px;}
.fog-layer{pointer-events:none;mix-blend-mode:normal;}
.fog-group{display:flex;gap:6px;}
.map-tools-group{display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin-left:auto;}
.aoe-group{display:flex;gap:4px;}
.fog-adv-group{display:flex;gap:6px;align-items:center;}
.fog-adv-group input[type=range]{width:90px;}
.initiative-panel{position:absolute;right:10px;top:10px;background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;padding:10px 12px;width:220px;box-shadow:var(--shadow-1);font-size:12px;z-index:30;}
.initiative-panel .panel-head{font-weight:600;display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:12px;}
.initiative-panel ol{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:4px;max-height:280px;overflow:auto;}
.initiative-panel li{background:linear-gradient(145deg,#20252a,#1b1f23);border:1px solid var(--border);padding:4px 8px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;gap:6px;}
.initiative-panel li.active{outline:2px solid var(--accent);}
.initiative-panel button{font-size:10px;padding:4px 6px;}
.ruler-line{position:absolute;pointer-events:none;border:1px dashed var(--accent);}
.token-context{position:fixed;z-index:500;background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;min-width:180px;padding:6px 0;box-shadow:0 12px 32px -10px rgba(0,0,0,.7);font-size:13px;}
.token-context.hidden{display:none;}
.token-context ul{list-style:none;margin:0;padding:0;}
.token-context li{padding:8px 14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.token-context li:hover{background:#1d2328;}
.walls-layer{mix-blend-mode:normal;}
.overlay-layer{mix-blend-mode:normal;}
.template-shape{position:absolute;pointer-events:auto;border:2px dashed var(--accent);background:rgba(79,141,255,.12);border-radius:50%;}
.template-shape[data-kind="cone"],.template-shape[data-kind="line"]{border-radius:0;}
.template-shape .resize-handle{position:absolute;width:14px;height:14px;background:var(--accent);border-radius:50%;right:-7px;bottom:-7px;cursor:nwse-resize;box-shadow:0 0 0 2px #000;}
.multi-select-rect{position:absolute;border:2px dashed var(--accent);background:rgba(79,141,255,.15);pointer-events:none;z-index:25;}
.map-stage.background-image #battleMap{background-size:cover;background-position:center;}
.token.highlight-move{animation:ping 1s ease-in-out infinite alternate;}
@keyframes ping {from {filter:brightness(1);} to {filter:brightness(1.5);} }

/* Compendium */
.comp-toolbar {display:flex;gap:18px;align-items:center;margin-bottom:16px;flex-wrap:wrap;}
.comp-detail {margin-top:24px;padding:22px 24px;border:1px solid var(--border);border-radius:20px;background:var(--bg-raised);box-shadow:var(--shadow-1);} 
.comp-detail.hidden {display:none;}
input#compSearch {background:var(--bg-raised);border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:var(--radius-m);}
.modal {position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;padding:30px;z-index:200;backdrop-filter:blur(4px);} 
.modal.hidden {display:none;}
.modal-panel {width:100%;max-width:640px;background:var(--bg-alt);border:1px solid var(--border);border-radius:18px;padding:26px 30px 34px;display:flex;flex-direction:column;gap:18px;box-shadow:0 10px 32px -8px rgba(0,0,0,.7);} 
.modal-panel.edit-panel {max-width:520px;}
.drop-overlay {position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:500;letter-spacing:.5px;color:var(--text);z-index:400;font-family:inherit;text-align:center;padding:40px;}
.drop-overlay.hidden {display:none;}
form#editForm {display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));}
form#editForm label {display:flex;flex-direction:column;font-size:11px;gap:4px;font-weight:600;color:var(--text-dim);}
form#editForm input, form#editForm textarea {background:var(--bg-raised);border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:10px;font-size:12px;}
form#editForm textarea {min-height:80px;resize:vertical;}
.modal-panel header {display:flex;align-items:center;justify-content:space-between;margin:-6px -6px 4px;}
.modal-panel h2 {margin:0;font-size:20px;letter-spacing:.5px;}
.close-btn {all:unset;cursor:pointer;font-size:26px;line-height:1;padding:4px 10px;border-radius:10px;background:var(--bg-raised);border:1px solid var(--border);} 
.close-btn:hover {border-color:var(--border-accent);} 
textarea#sheetUrlInput {min-height:120px;background:var(--bg-raised);color:var(--text);border:1px solid var(--border);border-radius:14px;padding:12px 14px;font-family:ui-monospace,monospace;font-size:13px;resize:vertical;}
textarea#sheetUrlInput:focus {outline:2px solid var(--accent);} 
.modal .actions {display:flex;gap:14px;flex-wrap:wrap;}

::-webkit-scrollbar {width:10px;height:10px;}
::-webkit-scrollbar-track {background:var(--bg);}
::-webkit-scrollbar-thumb {background:var(--border);border-radius:6px;}
::-webkit-scrollbar-thumb:hover {background:var(--border-accent);}

/* Moves view */
.moves-layout{display:grid;grid-template-columns:340px 1fr;gap:1.2rem;align-items:start}
.moves-editor{background:var(--bg-raised);border:1px solid var(--border);border-radius:20px;padding:18px 20px;box-shadow:var(--shadow-1);position:sticky;top:78px;align-self:start}
.moves-editor h2{margin:0 0 10px;font-size:18px;letter-spacing:.5px}
.moves-editor form label{display:flex;flex-direction:column;font-size:11px;gap:6px;font-weight:600;color:var(--text-dim);margin-bottom:10px}
.moves-editor input,.moves-editor textarea{background:var(--bg-alt);border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:12px;font:inherit;font-size:13px;}
.moves-editor input:focus,.moves-editor textarea:focus{outline:2px solid var(--accent);}
.moves-editor textarea{min-height:120px;resize:vertical}
.row-btns{display:flex;flex-wrap:wrap;gap:.6rem;margin-top:.4rem}
.moves-table{width:100%;border-collapse:collapse;font-size:13px;background:var(--bg-raised);border:1px solid var(--border);border-radius:18px;overflow:hidden;box-shadow:var(--shadow-1);}
.moves-table th{background:var(--bg-alt);text-align:left;font-size:11px;letter-spacing:.5px;text-transform:uppercase;padding:10px 12px;position:sticky;top:0;z-index:5}
.moves-table td{padding:10px 12px;border-top:1px solid var(--border)}
.moves-table tbody tr:hover{background:#1a1f23}
.moves-table .tag{background:var(--accent);color:#000;padding:2px 8px;border-radius:14px;font-size:10px;font-weight:600;display:inline-block;margin:0 6px 6px 0}
.moves-table .actions-col{width:90px}
.moves-table button{font-size:10px;padding:4px 8px;margin-right:4px}
#movesEmpty{padding:30px;text-align:center;opacity:.6;font-size:13px}
.hidden{display:none!important}
