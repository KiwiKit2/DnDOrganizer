/* Root theme vars */
:root {
  --bg: #0d0f11;
  --bg-alt: #14171a;
  --bg-raised: #1d2125;
  --border: #2a2f35;
  --border-accent: #444b53;
  --text: #d6d9dd;
  --text-dim: #7d848c;
  --accent: #4f8dff;
  --accent-glow: 174 72% 56%;
  --danger: #ff5576;
  --radius-s: 4px;
  --radius-m: 8px;
  --radius-l: 14px;
  --shadow-1: 0 2px 4px -2px rgba(0,0,0,.5),0 4px 16px -4px rgba(0,0,0,.4);
  font-family: 'Inter', system-ui, sans-serif;
  color-scheme: dark;
}

.light {
  --bg: #f5f7fa;
  --bg-alt: #ffffff;
  --bg-raised: #ffffff;
  --border: #dfe3e7;
  --border-accent: #b9c2ca;
  --text: #222;
  --text-dim: #66707a;
  --accent: #155eef;
  --danger: #d43652;
  color-scheme: light;
}

html,body {height:100%;margin:0;padding:0;background:var(--bg);color:var(--text);} 
body {display:flex;}

.app-shell {display:flex;flex:1;min-height:100vh;width:100%;}
.sidebar {width:220px;background:linear-gradient(180deg,var(--bg-alt),var(--bg));border-right:1px solid var(--border);display:flex;flex-direction:column;padding:18px 14px;gap:20px;}
.brand {font-size:20px;font-weight:600;letter-spacing:.5px;}
.nav {display:flex;flex-direction:column;gap:6px;}
.nav-btn {all:unset;cursor:pointer;padding:10px 12px;border-radius:var(--radius-m);font-size:14px;font-weight:500;background:var(--bg-raised);border:1px solid var(--border);transition:.25s;background:linear-gradient(145deg,#171b1f,#15181b);}
.nav-btn:hover {border-color:var(--border-accent);}
.nav-btn.active {background:var(--accent);color:#fff;box-shadow:0 0 0 1px #000,0 0 0 2px var(--accent);}
.sidebar-footer {margin-top:auto;display:flex;align-items:center;gap:10px;}
.toggle {display:flex;align-items:center;gap:4px;font-size:12px;cursor:pointer;}
.toggle input {accent-color:var(--accent);}

.main {flex:1;display:flex;flex-direction:column;}
.topbar {display:flex;align-items:center;gap:14px;padding:12px 18px;border-bottom:1px solid var(--border);background:var(--bg-alt);backdrop-filter:blur(8px);position:sticky;top:0;z-index:20;}
.breadcrumbs {font-size:13px;color:var(--text-dim);}
#search {background:var(--bg-raised);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:var(--radius-l);min-width:220px;font-size:14px;}
#search:focus {outline:2px solid var(--accent);}
#themeSwitch {background:var(--bg-raised);color:var(--text);border:1px solid var(--border);border-radius:50%;width:38px;height:38px;cursor:pointer;font-size:16px;display:grid;place-items:center;}
#themeSwitch:hover {border-color:var(--accent);}
.pulse {animation:pulse 1s ease-in-out 0s 4 alternate;}
@keyframes pulse {from {box-shadow:0 0 0 0 var(--accent);} to {box-shadow:0 0 0 6px rgba(79,141,255,0);} }

.view {display:none;padding:18px 22px;animation:fade .4s ease;}
.view.active {display:block;}
@keyframes fade {from {opacity:0;transform:translateY(6px);} to {opacity:1;transform:translateY(0);} }

.toolbar {display:flex;justify-content:space-between;align-items:center;gap:20px;margin-bottom:12px;flex-wrap:wrap;}
.table-wrap {overflow:auto;border:1px solid var(--border);border-radius:var(--radius-m);background:var(--bg-raised);box-shadow:var(--shadow-1);max-height:calc(100vh - 250px);}
#dataTable {border-collapse:collapse;width:100%;min-width:800px;font-size:13px;}
#dataTable th,#dataTable td {padding:8px 10px;border-bottom:1px solid var(--border);text-align:left;}
#dataTable thead th {position:sticky;top:0;background:var(--bg-alt);z-index:5;font-weight:600;font-size:12px;letter-spacing:.5px;text-transform:uppercase;cursor:pointer;}
#dataTable tbody tr {transition:.15s;background:linear-gradient(145deg,#14171a,#121416);}
#dataTable tbody tr:hover {background:#1b2024;}
#dataTable tbody tr.selected {outline:2px solid var(--accent);}

.mini-btn, .accent-btn {all:unset;cursor:pointer;background:var(--accent);color:#fff;padding:8px 14px;border-radius:var(--radius-m);font-size:12px;font-weight:600;letter-spacing:.5px;box-shadow:0 2px 4px -2px rgba(0,0,0,.6),0 4px 10px -2px rgba(0,0,0,.4);}
.mini-btn {background:var(--bg-raised);color:var(--text);border:1px solid var(--border);padding:6px 10px;font-weight:500;transition:all 0.15s ease;}
.mini-btn:hover {border-color:var(--border-accent);}
.mini-btn:active {transform:translateY(1px);}
.mini-btn.active {background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 0 8px rgba(74, 144, 226, 0.3);}
.mini-btn.danger {color:#ff667d;border-color:#ff667d;background:rgba(255,80,110,0.08);} 
.mini-btn.danger:hover {background:rgba(255,80,110,0.15);} 
.accent-btn:hover {filter:brightness(1.1);}

select {background:var(--bg-raised);color:var(--text);border:1px solid var(--border);padding:6px 10px;border-radius:var(--radius-m);font-size:13px;}
select:focus {outline:2px solid var(--accent);}

.kanban {display:flex;gap:18px;align-items:flex-start;overflow-x:auto;padding-bottom:20px;}
.board-toolbar {display:flex;gap:16px;align-items:center;margin-bottom:14px;flex-wrap:wrap;}
.empty-hint {margin-top:20px;font-size:13px;color:var(--text-dim);} 
.empty-hint.hidden {display:none;}
.kanban-column {background:var(--bg-raised);border:1px solid var(--border);border-radius:var(--radius-m);min-width:260px;display:flex;flex-direction:column;max-height:calc(100vh - 240px);}
.kanban-column header {padding:10px 14px;font-size:13px;font-weight:600;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.kanban-column header span {opacity:.55;font-weight:500;}
.kanban-column.over-wip header {background:linear-gradient(90deg,rgba(255,85,118,0.18),transparent);}
.kanban-column header .add-mini {padding:4px 8px;font-size:11px;}
.kanban-column header .col-title {cursor:pointer;}
.kanban-cards {display:flex;flex-direction:column;gap:10px;overflow:auto;padding:14px;}
.board-summary{display:flex;flex-wrap:wrap;gap:10px;margin:4px 0 14px;font-size:11px}
.board-summary .metric{background:var(--bg-raised);border:1px solid var(--border);padding:6px 10px;border-radius:30px;display:flex;align-items:center;gap:8px;line-height:1}
.board-summary .metric .bar{width:90px;height:6px;background:#1a1f23;border-radius:4px;overflow:hidden;position:relative}
.board-summary .metric .bar span{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,var(--accent),#7fb3ff);}
.card {background:linear-gradient(145deg,#20252a,#1b1f23);border:1px solid var(--border);border-radius:var(--radius-m);padding:10px 12px;font-size:12px;display:flex;flex-direction:column;gap:6px;cursor:grab;box-shadow:0 2px 4px -2px rgba(0,0,0,.6),0 4px 16px -4px rgba(0,0,0,.4);} 
.card.dragging {opacity:.4;}
.card h4 {margin:0;font-size:12px;font-weight:600;}
.card .meta {display:flex;flex-wrap:wrap;gap:6px;font-size:11px;color:var(--text-dim);}
.badge {background:var(--accent);color:#fff;padding:2px 6px;border-radius:var(--radius-s);font-size:10px;font-weight:600;letter-spacing:.5px;}
.card img.thumb {width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:10px;border:1px solid var(--border);background:#111;}
.grid-board {display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:16px;padding:10px 4px;}
.grid-token {background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;padding:10px;display:flex;flex-direction:column;gap:8px;position:relative;box-shadow:var(--shadow-1);} 
.grid-token img {width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:12px;border:1px solid var(--border);background:#090b0d;}
.grid-token h5 {margin:0;font-size:13px;font-weight:600;}
.tag-row {display:flex;flex-wrap:wrap;gap:6px;font-size:10px;color:var(--text-dim);} 

.footer {margin-top:auto;padding:10px 18px;font-size:12px;color:var(--text-dim);border-top:1px solid var(--border);background:var(--bg-alt);display:flex;gap:18px;align-items:center;}

/* Lean mode reduces navigation to Map only */
.lean .nav .nav-btn{display:none}
.lean .nav .nav-btn[data-view="map"]{display:block}
.lean #view-table,.lean #view-board,.lean #view-moves,.lean #view-entities,.lean #view-about{display:none!important}

.help-fab{position:fixed;right:16px;bottom:16px;width:44px;height:44px;border-radius:50%;border:1px solid var(--border);background:var(--accent);color:#fff;font-weight:800;font-size:18px;display:grid;place-items:center;box-shadow:var(--shadow-1);z-index:500;cursor:pointer}

.prose {max-width:760px;}
.prose h1 {margin-top:0;font-size:28px;}
.prose code {background:var(--bg-raised);padding:2px 6px;border-radius:var(--radius-s);}

.stats-summary {display:grid;gap:12px;margin-top:24px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));}
.stat-box {background:var(--bg-raised);border:1px solid var(--border);padding:14px 16px;border-radius:var(--radius-m);display:flex;flex-direction:column;gap:4px;}
.stat-box h3 {margin:0;font-size:13px;font-weight:600;color:var(--text-dim);}
.stat-box .value {font-size:20px;font-weight:600;}

/* Modal */
/* Map prototype */
.map-toolbar {display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap;}
.map-toolbar.compact{justify-content:space-between}
.map-toolbar .map-left,.map-toolbar .map-right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.map-more{border:1px solid var(--border);border-radius:12px;background:var(--bg-raised);padding:10px 12px;box-shadow:var(--shadow-1);margin-bottom:10px}
.map-more .more-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}
/* Hide clutter on Map view: keep theme and help only */
.main .topbar .hide-on-map{display:inline-flex}
/* When Map view is active, hide marked controls */
body:has(#view-map.view.active) .topbar .hide-on-map{display:none !important}
.map-stage {position:relative;overflow:auto;border:1px solid var(--border);border-radius:18px;background:#0b0e10;min-height:520px;box-shadow:var(--shadow-1);transition:all 0.2s ease;} 
.map-stage.mode-wall {cursor:crosshair;}
.map-stage.mode-reveal {cursor:crosshair;}
.map-stage.mode-ruler {cursor:crosshair;}
#battleMap {background:repeating-conic-gradient(from 0deg,#111 0deg,#111 90deg,#101417 90deg,#101417 180deg);background-size:60px 60px;display:block;border-radius:14px;}
.token-layer,.fog-layer,.walls-layer,.overlay-layer {position:absolute;left:0;top:0;inset:0;}
.token-layer {pointer-events:auto;}
.fog-layer {pointer-events:none;}
.map-stage.mode-reveal .fog-layer {pointer-events:auto;cursor:crosshair;}
.walls-layer {pointer-events:none;}
.overlay-layer {pointer-events:auto;}
.cursor-layer{position:absolute;left:0;top:0;inset:0;pointer-events:none;z-index:40}
.remote-cursor{position:absolute;transform:translate(-50%,-50%);display:flex;align-items:center;gap:6px}
.remote-cursor .dot{width:10px;height:10px;border-radius:50%;box-shadow:0 0 0 2px #000}
.remote-cursor .tag{font-size:11px;background:var(--bg-alt);border:1px solid var(--border);padding:2px 6px;border-radius:10px;box-shadow:var(--shadow-1)}
.token {position:absolute;transform:translate(-50%,-50%);width:50px;height:50px;border:2px solid var(--accent);border-radius:50%;background:#4a90e2 center/cover no-repeat;box-shadow:0 4px 12px -4px rgba(0,0,0,.6);cursor:pointer;user-select:none;} 
.token[data-type="enemy"] {border-color:#ff5576;}
.token[data-type="player"] {border-color:#4f8dff;}
.token.selected {outline:3px solid #fff;}
.token .direction-indicator {position:absolute;top:-8px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:12px solid white;pointer-events:none;z-index:10;}
.token .badge-stack {position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);display:flex;gap:4px;}
.token .hp-badge {background:#1a2228;color:#fff;font-size:9px;padding:2px 5px;border-radius:10px;border:1px solid var(--border);min-width:26px;text-align:center;}
.token .status-dot {width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 1px #000;}
.map-hint {font-size:12px;color:var(--text-dim);margin-top:10px;}
.fog-layer{pointer-events:none;mix-blend-mode:normal;}
.fog-group{display:flex;gap:6px;}
.map-tools-group{display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin-left:auto;}
.aoe-group{display:flex;gap:4px;}
.scenes-group{display:flex;gap:6px;align-items:center}
.fog-adv-group{display:flex;gap:6px;align-items:center;}
.fog-adv-group input[type=range]{width:90px;}
.layer-toggles{display:flex;gap:10px;align-items:center;margin-left:6px;font-size:12px;color:var(--text-dim);}
.layer-toggles label{display:flex;gap:6px;align-items:center;}
.toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:var(--bg-alt);border:1px solid var(--border);padding:10px 14px;border-radius:12px;box-shadow:var(--shadow-1);font-size:12px;z-index:600}
.toast.hidden{display:none}
.gm-mode .fog-layer{opacity:.25}
.initiative-panel{position:absolute;right:10px;top:10px;background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;padding:10px 12px;width:220px;box-shadow:var(--shadow-1);font-size:12px;z-index:30;}
.initiative-panel .panel-head{font-weight:600;display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:12px;}
.initiative-panel ol{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:4px;max-height:280px;overflow:auto;}
.initiative-panel li{background:linear-gradient(145deg,#20252a,#1b1f23);border:1px solid var(--border);padding:4px 8px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;gap:6px;}
.initiative-panel li.active{outline:2px solid var(--accent);}
.token-panel{position:absolute;right:10px;top:310px;background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;padding:10px 12px;width:220px;box-shadow:var(--shadow-1);font-size:12px;z-index:30;display:flex;flex-direction:column;gap:8px}
.token-panel .panel-head{font-weight:600;margin-bottom:4px}
.token-panel label{display:flex;flex-direction:column;gap:4px;font-size:11px;color:var(--text-dim)}
.token-panel input, .token-panel select{background:var(--bg-alt);border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:10px;font:inherit;font-size:12px}

.scene-panel{position:absolute;right:240px;top:10px;background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;padding:10px 12px;width:240px;box-shadow:var(--shadow-1);font-size:12px;z-index:30;display:flex;flex-direction:column;gap:8px}
.scene-panel ul{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:6px;max-height:280px;overflow:auto}
.scene-panel li{display:flex;justify-content:space-between;gap:8px;align-items:center;background:linear-gradient(145deg,#20252a,#1b1f23);border:1px solid var(--border);padding:6px 8px;border-radius:10px}
.scene-panel li .title{flex:1}
.scene-panel .panel-actions{display:flex;gap:6px}

/* Simple Mode: hide advanced widgets */
.simple-mode .fog-adv-group,
.simple-mode #clearWallsBtn,
.simple-mode #clearTemplatesBtn,
.simple-mode #exportImageBtn,
.simple-mode #mapHelpBtn,
.simple-mode .aoe-group,
.simple-mode .layer-toggles,
.simple-mode .mp-group { display:none !important; }
.initiative-panel button{font-size:10px;padding:4px 6px;}
.ruler-line{position:absolute;pointer-events:none;border:1px dashed var(--accent);}
.token-context{position:fixed;z-index:500;background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;min-width:180px;padding:6px 0;box-shadow:0 12px 32px -10px rgba(0,0,0,.7);font-size:13px;}
.token-context.hidden{display:none;}
.token-context ul{list-style:none;margin:0;padding:0;}
.token-context li{padding:8px 14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.token-context li:hover{background:#1d2328;}
.walls-layer{mix-blend-mode:normal;}
.overlay-layer{mix-blend-mode:normal;}
.template-shape{position:absolute;pointer-events:auto;border:2px dashed var(--accent);background:rgba(79,141,255,.12);border-radius:50%;}
.template-shape[data-kind="cone"],.template-shape[data-kind="line"]{border-radius:0;}
.template-shape .resize-handle{position:absolute;width:14px;height:14px;background:var(--accent);border-radius:50%;right:-7px;bottom:-7px;cursor:nwse-resize;box-shadow:0 0 0 2px #000;}
.multi-select-rect{position:absolute;border:2px dashed var(--accent);background:rgba(79,141,255,.15);pointer-events:none;z-index:25;}
/* --- Enhanced wall mode UI --- */
.wall-overlay{position:absolute;inset:0;pointer-events:none;z-index:24;font-size:12px;font-weight:500;font-family:var(--font,Inter,Arial,sans-serif);} 
.wall-overlay .wall-hint{position:absolute;left:8px;top:8px;background:rgba(20,24,28,.85);padding:6px 10px;border:1px solid #2b343c;border-radius:6px;color:#dbe7f3;backdrop-filter:blur(6px);max-width:320px;line-height:1.3;}
.wall-preview{position:absolute;background:rgba(79,141,255,.22);border:2px solid rgba(79,141,255,.9);border-radius:2px;pointer-events:none;z-index:26;mix-blend-mode:screen;}
.wall-handle{position:absolute;width:10px;height:10px;background:#ffd24f;border:2px solid #111;border-radius:50%;cursor:grab;z-index:27;box-shadow:0 0 0 2px rgba(0,0,0,.4);} 
.wall-handle:active{cursor:grabbing;}
#wallModeBtn.active{background:linear-gradient(90deg,#4f8dff,#6fafff);color:#fff;box-shadow:0 0 0 2px rgba(79,141,255,.4);}
.wall-overlay.hidden,.wall-preview.hidden{display:none;}
/* --- Character Page --- */
.char-page{padding:16px;display:flex;flex-direction:column;gap:16px;max-width:1200px;margin:0 auto;}
.char-top{display:flex;gap:16px;}
.char-img-wrap{width:160px;height:160px;border:2px solid #2b343c;border-radius:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;background:#14191f;}
.char-img-wrap:hover{outline:2px solid var(--accent);} 
.char-img-placeholder{font-size:14px;opacity:.5;}
.char-name{width:100%;font-size:26px;font-weight:600;padding:8px 10px;border:2px solid #2b343c;border-radius:6px;background:#101417;color:#e6eef5;}
.char-desc{margin-top:8px;width:100%;min-height:130px;resize:vertical;font-size:14px;padding:10px;border:2px solid #2b343c;border-radius:8px;background:#101417;color:#dbe3ea;}
.char-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(55px,1fr));gap:4px;padding:8px;border:2px solid #2b343c;border-radius:10px;background:#101417;}
.char-stats .stat{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 4px;border:1px solid #273138;border-radius:8px;background:#141a20;min-width:50px;}
.char-stats .stat input{width:100%;text-align:center;font-size:14px;background:#0f1418;border:1px solid #2d3942;border-radius:4px;color:#e5edf5;padding:2px 4px;}
.char-inv textarea{width:100%;min-height:90px;resize:vertical;background:#0f1418;color:#dbe3ea;border:1px solid #273138;border-radius:8px;padding:6px;font-size:13px;line-height:1.35;}
.inv-sections{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:8px;}
.inv-block{display:flex;flex-direction:column;gap:4px;}
.inv-block.wide{grid-column:span 2;}
.char-moves-head{display:flex;align-items:center;gap:8px;}
#charMoveFilter,#charMoveAdd{background:#0f1418;border:1px solid #28323a;color:#d5dee6;padding:6px 8px;border-radius:6px;}
.char-move-list{display:flex;flex-direction:column;gap:10px;margin-top:12px;}
.char-move{border:1px solid #273138;border-radius:10px;padding:10px 12px;background:#10171c;display:flex;flex-direction:column;gap:6px;position:relative;}
.char-move h3{margin:0;font-size:15px;display:flex;align-items:center;gap:8px;}
.char-move .tags{display:flex;flex-wrap:wrap;gap:4px;}
.char-move .tag{background:#182129;border:1px solid #25303a;border-radius:4px;padding:2px 6px;font-size:11px;letter-spacing:.5px;text-transform:uppercase;}
.char-move button.remove-move{position:absolute;top:6px;right:6px;background:#2a333a;color:#dbe3ea;border:none;border-radius:4px;padding:2px 6px;cursor:pointer;font-size:11px;}
.char-move button.remove-move:hover{background:#ff5576;color:#fff;}
.char-suggestions{position:absolute;background:#10171c;border:1px solid #273138;border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px;max-height:260px;overflow:auto;width:260px;z-index:60;margin-top:4px;}
.char-suggestions button{background:#162027;border:1px solid #22313b;color:#dbe3ea;text-align:left;padding:4px 6px;border-radius:4px;font-size:12px;cursor:pointer;}
.char-suggestions button:hover{background:#4f8dff;color:#fff;}
.map-stage.background-image #battleMap{background-size:cover;background-position:center;}
.token.highlight-move{animation:ping 1s ease-in-out infinite alternate;}
@keyframes ping {from {filter:brightness(1);} to {filter:brightness(1.5);} }

/* Compendium */
.comp-toolbar {display:flex;gap:18px;align-items:center;margin-bottom:16px;flex-wrap:wrap;}
.comp-detail {margin-top:24px;padding:22px 24px;border:1px solid var(--border);border-radius:20px;background:var(--bg-raised);box-shadow:var(--shadow-1);} 
.comp-detail.hidden {display:none;}
input#compSearch {background:var(--bg-raised);border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:var(--radius-m);}
.modal {position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;padding:30px;z-index:200;backdrop-filter:blur(4px);} 
.modal.hidden {display:none;}
.modal-panel {width:100%;max-width:640px;background:var(--bg-alt);border:1px solid var(--border);border-radius:18px;padding:26px 30px 34px;display:flex;flex-direction:column;gap:18px;box-shadow:0 10px 32px -8px rgba(0,0,0,.7);} 
.modal-panel.edit-panel {max-width:520px;}
form#editForm {display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));}
form#editForm label {display:flex;flex-direction:column;font-size:11px;gap:4px;font-weight:600;color:var(--text-dim);}
form#editForm input, form#editForm textarea {background:var(--bg-raised);border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:10px;font-size:12px;}
form#editForm textarea {min-height:80px;resize:vertical;}
.modal-panel header {display:flex;align-items:center;justify-content:space-between;margin:-6px -6px 4px;}
.modal-panel h2 {margin:0;font-size:20px;letter-spacing:.5px;}
.close-btn {all:unset;cursor:pointer;font-size:26px;line-height:1;padding:4px 10px;border-radius:10px;background:var(--bg-raised);border:1px solid var(--border);} 
.close-btn:hover {border-color:var(--border-accent);} 
textarea#sheetUrlInput {min-height:120px;background:var(--bg-raised);color:var(--text);border:1px solid var(--border);border-radius:14px;padding:12px 14px;font-family:ui-monospace,monospace;font-size:13px;resize:vertical;}
textarea#sheetUrlInput:focus {outline:2px solid var(--accent);} 
.modal .actions {display:flex;gap:14px;flex-wrap:wrap;}

/* Session banner */
.session-banner{display:flex;align-items:center;gap:10px;margin:8px 0 12px;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:var(--bg-raised);box-shadow:var(--shadow-1);font-size:12px}
.session-banner .pill{background:var(--bg-alt);border:1px solid var(--border);padding:4px 8px;border-radius:999px;font-weight:600}
.session-banner .grow{flex:1;color:var(--text-dim)}
.session-banner button{padding:6px 10px}
.input-with-btn{display:flex;gap:8px}
.input-with-btn input{flex:1}

/* Welcome modal simplified UI */
.welcome-simple{display:flex;flex-direction:column;gap:10px}
.welcome-simple label{display:flex;flex-direction:column;gap:6px;font-size:11px;color:var(--text-dim);font-weight:600}
.welcome-simple input{background:var(--bg-raised);border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:12px;font-size:13px}
/* Welcome modal refinements */
.welcome-simple .wl-row{display:flex;gap:8px;margin-top:6px}
.welcome-simple .join-block{margin-top:12px}
.welcome-simple .host-code{margin-top:10px;padding:8px 10px;background:var(--bg-raised);border:1px solid var(--border);border-radius:10px;font-weight:600;letter-spacing:1px;text-align:center;font-size:15px}
.welcome-simple .host-code.copied{outline:2px solid var(--accent);}
.adv-box{margin-top:12px;padding:6px 8px;border:1px solid var(--border);border-radius:10px;background:var(--bg-alt)}
.adv-box summary{cursor:pointer;font-weight:500;}
.or-sep{display:flex;align-items:center;gap:8px;opacity:.7}
.or-sep::before,.or-sep::after{content:"";height:1px;background:var(--border);flex:1}

::-webkit-scrollbar {width:10px;height:10px;}
::-webkit-scrollbar-track {background:var(--bg);}
::-webkit-scrollbar-thumb {background:var(--border);border-radius:6px;}
::-webkit-scrollbar-thumb:hover {background:var(--border-accent);}

/* Moves view */
.moves-layout{display:grid;grid-template-columns:340px 1fr;gap:1.2rem;align-items:start}
.moves-editor{background:var(--bg-raised);border:1px solid var(--border);border-radius:20px;padding:18px 20px;box-shadow:var(--shadow-1);position:sticky;top:78px;align-self:start}
.moves-layout{display:grid;grid-template-columns:340px 1fr;gap:1.5rem;align-items:start;padding:0 1rem;}
.moves-editor{background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:var(--shadow-1);position:sticky;top:78px;align-self:start}
.moves-editor h2{margin:0 0 20px;font-size:18px;letter-spacing:.5px;color:var(--text);font-weight:600;}
.moves-editor .form-row{margin-bottom:16px;}
.moves-editor .form-row.two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;}
.moves-editor .form-row.two-col label{margin-bottom:0;flex:1;}
.moves-editor form label{display:flex;flex-direction:column;font-size:12px;gap:8px;font-weight:600;color:var(--text-dim);}
.moves-editor input,.moves-editor textarea,.moves-editor select{background:var(--bg-alt);border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:8px;font:inherit;font-size:13px;transition:border-color 0.2s ease;}
.moves-editor input:focus,.moves-editor textarea:focus,.moves-editor select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(79, 141, 255, 0.1);}
.moves-editor textarea{min-height:100px;resize:vertical;}
.form-actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border);}
.moves-toolbar{display:flex;gap:12px;margin-bottom:16px;align-items:center;}
.moves-toolbar input{flex:1;background:var(--bg-alt);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;font-size:13px;}
.mini-select{background:var(--bg-alt);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;font-size:13px;min-width:140px;}
.category-badge{display:inline-block;padding:4px 8px;border-radius:6px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;}
.category-attack{background:#dc2626;color:white;}
.category-spell{background:#7c3aed;color:white;}
.category-utility{background:#0891b2;color:white;}
.category-defense{background:#059669;color:white;}
.category-movement{background:#ea580c;color:white;}
.category-social{background:#c2410c;color:white;}
.category-other{background:#6b7280;color:white;}
.empty-hint{text-align:center;padding:60px 20px;color:var(--text-dim);}
.empty-hint .empty-content h3{margin:0 0 8px;color:var(--text);font-size:18px;font-weight:500;}
.empty-hint .empty-content p{margin:0;font-size:14px;}

/* Image Upload and Cropping */
.file-input{padding:8px 0 !important;cursor:pointer;}
.image-preview-container{margin-top:12px;text-align:center;}
.image-preview{max-width:100%;max-height:200px;border-radius:8px;border:1px solid var(--border);}
.image-cropper-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px;}
.image-cropper-content{background:var(--bg-raised);border-radius:16px;padding:24px;max-width:600px;width:100%;max-height:90vh;overflow:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);}
.image-cropper-content h3{margin:0 0 20px;color:var(--text);font-size:20px;text-align:center;}
.crop-container{position:relative;margin:20px 0;background:#000;border-radius:8px;overflow:hidden;max-height:400px;display:flex;justify-content:center;align-items:center;}
.crop-container img{max-width:100%;max-height:400px;display:block;object-fit:contain;}
.crop-overlay{position:absolute;border:2px solid var(--accent);background:rgba(79,141,255,0.1);cursor:move;min-width:50px;min-height:50px;}
.crop-overlay::before{content:'';position:absolute;top:-1px;left:-1px;right:-1px;bottom:-1px;border:1px dashed rgba(255,255,255,0.8);pointer-events:none;}
.crop-handles{position:absolute;top:0;left:0;right:0;bottom:0;}
.crop-handle{position:absolute;width:12px;height:12px;background:var(--accent);border:2px solid white;border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.3);}
.crop-handle:hover{background:#5a9eff;transform:scale(1.1);}
.crop-handle.nw{top:-6px;left:-6px;cursor:nw-resize;}
.crop-handle.ne{top:-6px;right:-6px;cursor:ne-resize;}
.crop-handle.sw{bottom:-6px;left:-6px;cursor:sw-resize;}
.crop-handle.se{bottom:-6px;right:-6px;cursor:se-resize;}
.crop-handle.n{top:-6px;left:50%;transform:translateX(-50%);cursor:n-resize;}
.crop-handle.s{bottom:-6px;left:50%;transform:translateX(-50%);cursor:s-resize;}
.crop-handle.w{top:50%;left:-6px;transform:translateY(-50%);cursor:w-resize;}
.crop-handle.e{top:50%;right:-6px;transform:translateY(-50%);cursor:e-resize;}
.crop-actions{display:flex;gap:12px;justify-content:center;margin-top:20px;padding-top:20px;border-top:1px solid var(--border);}
.crop-preview{margin-top:16px;text-align:center;}
.crop-preview-img{width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid var(--accent);margin:0 auto;display:block;}
.crop-instructions{color:var(--text-dim);font-size:13px;text-align:center;margin-bottom:16px;line-height:1.4;}

/* Character Image Improvements */
.char-img-wrap{position:relative;cursor:pointer;transition:all 0.2s ease;border-radius:12px;overflow:hidden;}
.char-img-wrap:hover{transform:scale(1.02);box-shadow:0 4px 20px rgba(79,141,255,0.2);}
.char-img-wrap::after{content:'Right-click for options';position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent, rgba(0,0,0,0.8));color:white;padding:8px;font-size:11px;text-align:center;opacity:0;transition:opacity 0.2s ease;}
.char-img-wrap:hover::after{opacity:1;}

/* Context Menu */
.context-menu{position:fixed;background:var(--bg-raised);border:1px solid var(--border);border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,0.3);z-index:2000;min-width:160px;padding:4px 0;}
.context-menu-item{padding:10px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;font-size:14px;color:var(--text);transition:background-color 0.15s ease;}
.context-menu-item:hover{background:var(--bg-hover);}
.context-menu-item span{font-size:16px;width:20px;text-align:center;}
.moves-editor textarea{min-height:120px;resize:vertical}
.row-btns{display:flex;flex-wrap:wrap;gap:.6rem;margin-top:.4rem}
.moves-table{width:100%;border-collapse:collapse;font-size:13px;background:var(--bg-raised);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:var(--shadow-1);}
.moves-table th{background:var(--bg-alt);text-align:left;font-size:11px;letter-spacing:.5px;text-transform:uppercase;padding:12px 14px;position:sticky;top:0;z-index:5;font-weight:600;color:var(--text-dim);}
.moves-table td{padding:12px 14px;border-bottom:1px solid var(--border);vertical-align:top;line-height:1.4;}
.moves-table tr:hover{background:var(--bg-hover);}
.moves-table .actions-col{width:120px;text-align:center;}
.moves-table button{font-size:11px;padding:6px 10px;margin:0 2px;border-radius:6px;}
.moves-table .category-badge{margin-right:0;}
.moves-table .tag{background:var(--accent);color:#000;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:600;display:inline-block;margin:0 4px 4px 0;}
#movesEmpty{padding:30px;text-align:center;opacity:.6;font-size:13px}
.hidden{display:none!important}
.locked .map-stage{pointer-events:none;}

/* D&D Character Sheet Styles */
.char-page { 
  padding: 20px; 
  max-width: 1200px; 
  margin: 0 auto; 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
}

.char-header {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 20px;
  align-items: start;
  background: var(--bg-raised);
  border: 1px solid var(--border);
  border-radius: var(--radius-l);
  padding: 20px;
}

.char-main-info {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.char-name {
  font-size: 24px;
  font-weight: 700;
  background: var(--bg-alt);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 12px 16px;
  border-radius: var(--radius-m);
}

.char-basic-info {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}

.char-basic-info input {
  background: var(--bg-alt);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px 12px;
  border-radius: var(--radius-m);
  font-size: 14px;
}

.char-actions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.char-abilities, .char-combat-stats, .char-skills, .char-features, .char-backstory {
  background: var(--bg-raised);
  border: 1px solid var(--border);
  border-radius: var(--radius-l);
  padding: 20px;
}

.char-abilities h3, .char-combat-stats h3, .char-skills h3, .char-features h3, .char-backstory h3 {
  margin: 0 0 16px 0;
  font-size: 18px;
  color: var(--text);
}

.abilities-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 16px;
}

.ability-score {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  background: var(--bg-alt);
  border: 1px solid var(--border);
  border-radius: var(--radius-m);
  padding: 12px;
}

.ability-score label {
  font-weight: 600;
  font-size: 12px;
  color: var(--text-dim);
}

.ability-score input {
  width: 50px;
  text-align: center;
  background: var(--bg);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 6px;
  border-radius: var(--radius-s);
  font-size: 16px;
  font-weight: 600;
}

.modifier {
  font-size: 14px;
  font-weight: 600;
  color: var(--accent);
}

.combat-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 16px;
}

.stat-block {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.stat-block label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-dim);
}

.stat-block input {
  background: var(--bg-alt);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px 12px;
  border-radius: var(--radius-m);
  font-size: 14px;
}

.skills-grid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 24px;
}

.skill-section h4 {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: var(--text-dim);
}

.skill-section label {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  font-size: 13px;
  cursor: pointer;
}

.skill-section input[type="checkbox"] {
  accent-color: var(--accent);
}

.skills-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.char-features textarea, .char-backstory textarea {
  width: 100%;
  min-height: 120px;
  background: var(--bg-alt);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 12px;
  border-radius: var(--radius-m);
  font-family: inherit;
  font-size: 14px;
  resize: vertical;
}

.char-features textarea:focus, .char-backstory textarea:focus {
  outline: 2px solid var(--accent);
}

@media (max-width: 768px) {
  .char-header {
    grid-template-columns: 1fr;
  }
  
  .char-basic-info {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .abilities-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .combat-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .skills-grid {
    grid-template-columns: 1fr;
  }
}
